% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/wpa_era.R
\name{calculate_delivery_wpa}
\alias{calculate_delivery_wpa}
\title{Calculate Win Probability Added (WPA) for Deliveries}
\usage{
calculate_delivery_wpa(
  deliveries,
  stage1_model,
  stage2_model,
  stage1_feature_cols,
  stage2_feature_cols
)
}
\arguments{
\item{deliveries}{data.frame or data.table with delivery data including
match_id, innings, over, ball, runs_batter, runs_total, is_wicket,
total_runs, wickets_fallen, and all features required by the models.}

\item{stage1_model}{XGBoost model for projected score (1st innings)}

\item{stage2_model}{XGBoost model for win probability (2nd innings)}

\item{stage1_feature_cols}{Character vector of Stage 1 feature column names}

\item{stage2_feature_cols}{Character vector of Stage 2 feature column names}
}
\value{
data.frame with additional columns:
\itemize{
\item predicted_before: Prediction before this delivery
\item predicted_after: Prediction after this delivery
\item wpa: Win Probability Added (projected score change for 1st innings)
\item batter_wpa: WPA credited to batter
\item bowler_wpa: WPA credited to bowler
}
}
\description{
Calculates the change in win probability (2nd innings) or projected score
(1st innings) caused by each delivery. Positive WPA = good for batting team.
}
\examples{
\dontrun{
# Load models
stage1_results <- readRDS("bouncerdata/models/ipl_stage1_results.rds")
stage2_results <- readRDS("bouncerdata/models/ipl_stage2_results.rds")

# Calculate WPA for match deliveries
wpa_data <- calculate_delivery_wpa(
  deliveries = match_data,
  stage1_model = stage1_results$model,
  stage2_model = stage2_results$model,
  stage1_feature_cols = stage1_results$feature_cols,
  stage2_feature_cols = stage2_results$feature_cols
)
}
}
